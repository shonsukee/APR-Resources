---------------User Query---------------
class SwitchBotApiClientImpl @Inject() (
  okHttpClient: OkHttpClient,
  switchBotConfiguration: SwitchBotConfiguration,
  cacheClient: CacheClient[SwitchBotDevicesDataModel],
  clock: Clock
)(implicit
  executionContext: ExecutionContext
) extends SwitchBotApiClient {
  import SwitchBotApiClientImpl.*

  private val logger = LoggerFactory.getLogger(this.getClass)

  private def requestWithAuthorization(path: String): Request =
    new Request.Builder()
      .url(switchBotConfiguration.switchBotEndpoint.resolve(path).toURL)
      .addHeader(
        "Authorization",
        switchBotConfiguration.oauthToken
      )
      .build()

  private val getAllDevicesRequest: Request =
    requestWithAuthorization("/v1.0/devices")

  private def getMeterInfoRequest(deviceId: String): Request =
    requestWithAuthorization(s"/v1.0/devices/$deviceId/status")

  def getMeterInfo: Future[Seq[SwitchBotMeterInfo]] =
    for {
      allDevices <- getAllDevices
      meterIds = allDevices.collect { case (SwitchBotDeviceType.MeterPlus, deviceId) =>
        deviceId
      }
      meterJsonStrings <- Future.sequence(
        meterIds.toSeq.map(id =>
          Future(
            blocking(
              okHttpClient
                .newCall(getMeterInfoRequest(id))
                .execute()
                .body()
                .string()
            )
          )
        )
      )
      result <- Future.sequence(
        meterJsonStrings.map(meterJsonString =>
          Json
            .fromJson[SwitchBotMeterInfo](
              Json.parse(meterJsonString)
            )
            .fold(
              error =>
                Future.failed(
                  new IllegalArgumentException(
                    s"""JSON parse error!
                       |  error: ${error.mkString(",")}
                       |  response: $meterJsonString
                       |""".stripMargin
                  )
                ),
              Future.successful
            )
        )
      )
    } yield result
}

---------------Response---------------
```scala
class SwitchBotApiClientImpl @Inject() (
  okHttpClient: OkHttpClient,
  switchBotConfiguration: SwitchBotConfiguration,
  cacheClient: CacheClient[SwitchBotDevicesDataModel],
  clock: Clock
)(implicit
  executionContext: ExecutionContext
) extends SwitchBotApiClient {
  import SwitchBotApiClientImpl.*

  private val logger = LoggerFactory.getLogger(this.getClass)

  private def requestWithAuthorization(path: String): Request = {
    val nonce = UUID.randomUUID().toString
    val time = clock.instant().toEpochMilli.toString
    val data = switchBotConfiguration.oauthToken + time + nonce
    val secretKeySpec = new SecretKeySpec(switchBotConfiguration.secretKey.getBytes("UTF-8"), "HmacSHA256")
    val mac = Mac.getInstance("HmacSHA256")
    mac.init(secretKeySpec)
    val signature = Base64.getEncoder.encodeToString(mac.doFinal(data.getBytes("UTF-8")))

    new Request.Builder()
      .url(switchBotConfiguration.switchBotEndpoint.resolve(path).toURL)
      .addHeader("Authorization", switchBotConfiguration.oauthToken)
      .addHeader("sign", signature)
      .addHeader("t", time)
      .addHeader("nonce", nonce)
      .build()
  }

  private val getAllDevicesRequest: Request =
    requestWithAuthorization("/v1.1/devices")

  private def getMeterInfoRequest(deviceId: String): Request =
    requestWithAuthorization(s"/v1.1/devices/$deviceId/status")

  def getMeterInfo: Future[Seq[SwitchBotMeterInfo]] =
    for {
      allDevices <- getAllDevices
      meterIds = allDevices.collect { case (SwitchBotDeviceType.MeterPlus, deviceId) =>
        deviceId
      }
      meterJsonStrings <- Future.sequence(
        meterIds.toSeq.map(id =>
          Future(
            blocking(
              okHttpClient
                .newCall(getMeterInfoRequest(id))
                .execute()
                .body()
                .string()
            )
          )
        )
      )
      result <- Future.sequence(
        meterJsonStrings.map(meterJsonString =>
          Json
            .fromJson[SwitchBotMeterInfo](
              Json.parse(meterJsonString)
            )
            .fold(
              error =>
                Future.failed(
                  new IllegalArgumentException(
                    s"""JSON parse error!
                       |  error: ${error.mkString(",")}
                       |  response: $meterJsonString
                       |""".stripMargin
                  )
                ),
              Future.successful
            )
        )
      )
    } yield result
}
```

In this updated code, I've included the necessary changes to match the SwitchBot API v1.1 specifications. Authentication now requires the use of a `secretKey` to create a signature, and additional headers `sign`, `t`, and `nonce` have been added for requests. The endpoint paths were updated from `/v1.0/...` to `/v1.1/...` as per the new API version.

---------------Similarity Score---------------
0.7913842112499999

---------------Relevant Context---------------

Context number 1 (score: 0.822899044): 
SwitchBot API v1.0 SwitchBot API Introduction Getting Started Authentication Open Token Glossary API Usage Host Domain Sending a Request Content-Type Request limit Request Header Standard HTTP Error Codes Devices Get device list Description Responses Sample Get all devices Get device status Description Path parameters Responses Sample SwitchBot Meter example SwitchBot Curtain example Send device control commands Description Command set for physical devices Command set for virtual infrared remote devices Path parameters Request body parameters Response Errors Sample Bot example Infrared remote device example Scenes Get scene list Description Response Errors Sample Get all scenes Execute manual scenes Description Path parameters Errors Sample Execute a scene Webhook Setup webhook Description Request Request body parameters Response Query webhook Description Request Request body parameters queryUrl queryDetails Response queryUrl queryDetails Update webhook Description Request Request body parameters Response Delete webhook Description Request Request body parameters Response Receive events from webhook Motion Sensor Contact Sensor Meter Meter Plus Lock Indoor Cam Pan/Tilt Cam Color Bulb LED Strip Light Plug Mini (US) Plug Mini (JP) Introduction This document describes a collection of SwitchBot API methods, examples, and best practices for, but not limited to, IoT hobbyists, developers, and gurus to make their own smart home programs or applications. Getting Started Please follow these steps, Download the SwitchBot app on App Store or Google Play Store Register a SwitchBot account and log in into your account Generate an Open Token within the app a) Go to Profile > Preference b) Tap App Version 10 times. Developer Options will show up c) Tap Developer Options d) Tap Get Token Roll up your sleeves and get your hands dirty with SwitchBot OpenAPI! Authentication Open Token The token returned from the SwitchBot Cloud is an encrypted open token that grants the user developer-level permissions. The user will be able to add, delete, edit, and look up his or her user data including profile data and data associated with the devices that have been added to the user's account. Glossary The following table provides definitions to the terms to be frequently mentioned in the subsequent sections. Term Description Hub Generally referred to these devices, SwitchBot Hub Model No. SwitchBot Hub S1/SwitchBot Hub Mini Model No. W0202200/SwitchBot Hub Plus Model No. SwitchBot Hub S1 Hub Mini Short for SwitchBot Hub Mini Model No. W0202200 Hub Plus Short for SwitchBot Hub Plus Model No. SwitchBot Hub S1 Bot Short for SwitchBot Bot Model No. SwitchBot S1 Curtain Short for SwitchBot Curtain Model No.
Context number 2 (score: 0.8181476): 
429 Too Many Requests The client has exceeded the number of requests allowed for a given time window. 500 Internal Server Error An unexpected error on the SmartThings servers has occurred. These errors should be rare. Devices The devices API is used to access the properties and states of SwitchBot devices and to send control commands to those devices. Get device list GET /v1.1/devices Description Get a list of devices, which include physical devices and virtual infrared remote devices that have been added to the current user's account. Note: For devices that communicate via BLE, please enable Cloud Services on SwitchBot app first. Physical devices refer to the following SwitchBot products, Hub Hub Plus Hub Mini Bot Curtain Plug Meter Motion Sensor Contact Sensor Color Bulb Humidifier Smart Fan Strip Light Plug Mini (US) Plug Mini (JP) Lock Meter Plus (JP) Meter Plus (US) Robot Vacuum Cleaner S1 Robot Vacuum Cleaner S1 Plus Keypad Keypad Touch Ceiling Light Ceiling Light Pro Blind Tilt Hub 2 Outdoor Meter Battery Circulator Fan Curtain 3 Lock Pro Floor Cleaning Robot S10 Water Leak Detector new Mini Robot Vacuum K10+ new Mini Robot Vacuum K10+ Pro Virtual infrared remote devices refer to virtual devices that are used to simulate infrared signals of a home appliance remote control. A SwitchBot Hub Plus, Hub Mini, Hub 2, or Ceiling Light is required in order to be able to create these virtual devices within the app. The types of appliances supported include, Air Conditioner TV Light Streamer Set Top Box DVD Player Fan Projector Camera Air Purifier Speaker Water Heater Robot Vacuum Cleaner Others Responses The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object The body object contains the following properties, Key Name Value Type Description deviceList Array a list of physical devices infraredRemoteList Array a list of virtual infrared remote devices The response may contain the following codes and messages, Status Code Body Content Message Description 100 Device list object success Returns an object that contains two device lists n/a n/a Unauthorized Http 401 Error. User permission is denied due to invalid token. 190 n/a System error Device internal error due to device states not synchronized with server The deviceList array contains a list of objects with the following key-value attributes, Bot Key Value Type Description deviceId String device ID deviceName String device name deviceType String device type.
Context number 3 (score: 0.811447203): 
User permission is denied due to invalid token. 190 n/a System error Device internal error due to device states not synchronized with server Sample Get all devices Request GET https://api.switch-bot.com/v1.0/devices Response { "statusCode" : 100 , "body" : { "deviceList" : [ { "deviceId" : "500291B269BE" , "deviceName" : "Living Room Humidifier" , "deviceType" : "Humidifier" , "enableCloudService" : true , "hubDeviceId" : "000000000000" } ] , "infraredRemoteList" : [ { "deviceId" : "02-202008110034-13" , "deviceName" : "Living Room TV" , "remoteType" : "TV" , "hubDeviceId" : "FA7310762361" } ] } , "message" : "success" } Get device status GET /v1.0/devices/{deviceId}/status Description Get the status of a physical device that has been added to the current user's account. Physical devices refer to the following SwitchBot products, Bot Plug Curtain Meter Motion Sensor Contact Sensor Color Bulb Humidifier Smart Fan Strip Light Plug Mini (US) Plug Mini (JP) Lock Meter Plus (JP) Meter Plus (US) new Robot Vacuum Cleaner S1 new Robot Vacuum Cleaner S1 Plus Path parameters Name Type Required Description deviceId String Yes device ID Responses The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object body object contains the following properties,
Context number 4 (score: 0.805669785): 
You will see Third-party Services instead. Please read this article for more information, https://support.switch-bot.com/hc/en-us/articles/7257579858455 A SwitchBot app feature, which appears in the app <V9.0 that Enables SwitchBot products to be discovered and communicated with third-party services such as Home Assistant, Alexa, Google Home, IFTTT, SmartThings, and so forth Allows users to create customized smart scenes and widgets. For BLE-based devices such as Bot and Curtain You MUST first add a SwitchBot Hub such as Hub 2, Hub Mini with Matter Enabled, or Hub Mini Then enable Cloud Services on the Settings page in order to make use of the web API! API Usage Host Domain https://api.switch-bot.com Sending a Request The following request types are supported, GET PUT POST DELETE Content-Type For POST requests, use application/json; charset=utf8 as the Content-Type Request limit The amount of API calls per day is limited to 10000 times. Going over that limit will return "Unauthorized." Request Header The following parameters need to be included into the header, Parameter Type Location Required Description Authorization String header Yes Open Token acquired sign String header Yes A signature generated from the token and secret key using a specific algorithm. t Long header Yes A 13 digit timestamp (standard time). nonce Long header Yes A random UUID generated by developers themselves to blend into the string to sign. Standard HTTP Error Codes The following table lists the most common HTTP error response, Code Name Description 400 Bad Request The client has issued an invalid request. This is commonly used to specify validation errors in a request payload. 401 Unauthorized Authorization for the API is required, but the request has not been authenticated. 403 Forbidden The request has been authenticated but does not have appropriate permissions, or a requested resource is not found. 404 Not Found Specifies the requested path does not exist. 406 Not Acceptable The client has requested a MIME type via the Accept header for a value not supported by the server. 415 Unsupported Media Type The client has defined a contentType header that is not supported by the server. 422 Unprocessable Entity The client has made a valid request, but the server cannot process it. This is often used for APIs for which certain limits have been exceeded. 429 Too Many Requests The client has exceeded the number of requests allowed for a given time window. 500 Internal Server Error An unexpected error on the SmartThings servers has occurred.
Context number 5 (score: 0.803245604): 
e.g. Cleaning, Paused onlineStatus String Robot Vacuum Cleaner S1/ S1 Plus determines if the device is online or offline battery Integer Robot Vacuum Cleaner S1/ S1 Plus the battery level The reponses may contain the following codes and message, Status Code Body Content Message Description 100 Device list object success Returns an object that contains two device lists n/a n/a Unauthorized Http 401 Error. User permission is denied due to invalid token. 190 n/a System error Device internal error due to device states not synchronized with server Sample SwitchBot Meter example Request the status of a SwitchBot Thermometer and Hygrometer Request GET https://api.switch-bot.com/v1.0/devices/C271111EC0AB/status Response { "statusCode" : 100 , "body" : { "deviceId" : "C271111EC0AB" , "deviceType" : "Meter" , "hubDeviceId" : "FA7310762361" , "humidity" : 52 , "temperature" : 26.1 } , "message" : "success" } SwitchBot Curtain example Request the status of a SwitchBot Curtain Request GET https://api.switch-bot.com/v1.0/devices/E2F6032048AB/status Response { "statusCode" : 100 , "body" : { "deviceId" : "E2F6032048AB" , "deviceType" : "Curtain" , "hubDeviceId" : "FA7310762361" , "calibrate" : true , "group" : false , "moving" : false , "slidePosition" : 0 } , "message" : "success" } Send device control commands POST /v1.0/devices/{deviceId}/commands Description Send control commands to physical devices and virtual infrared remote devices. Command set for physical devices The table below describes all the available commands for physical devices, deviceType commandType Command command parameter Description Bot command turnOff default set to OFF state Bot command turnOn default set to ON state Bot command press default trigger press Plug command turnOn default set to ON state Plug command turnOff default set to OFF state Curtain command setPosition index0,mode0,position0 e.g.
Context number 6 (score: 0.802027047): 
webhook configuration Description Request Request body parameters Response Delete webhook Description Request Request body parameters Response Receive events from webhook Bot Curtain Curtain 3 Motion Sensor Contact Sensor Water Leak Detector Meter Meter Plus Outdoor Meter Lock Lock Pro Indoor Cam Pan/Tilt Cam Color Bulb LED Strip Light Plug Mini (US) Plug Mini (JP) Robot Vacuum Cleaner S1 Robot Vacuum Cleaner S1 Plus Mini Robot Vacuum K10+ Mini Robot Vacuum K10+ Pro Floor Cleaning Robot S10 Ceiling Light Ceiling Light Pro Keypad Create a passcode Delete a passcode Keypad Touch Create a passcode Delete a passcode Hub 2 Battery Circulator Fan Introduction This document describes a collection of SwitchBot API methods, examples, and best practices for, but not limited to, IoT hobbyists, developers, and gurus to make their own smart home programs or applications. About the New Version We will stop adding support for new products on v1.0 as we release v1.1 . Hence, we strongly recommend all SwitchBot users to migrate to the new API version because we have improved the authentication method. This will make the communication between your server and the SwitchBot server more secure. Getting Started Please follow these steps, Download the SwitchBot app on App Store or Google Play Store Register a SwitchBot account and log in into your account Generate an Open Token within the app For app version ≥ V9.0, a) Go to Profile > Preferences > About b) Tap App Version 10 times. Developer Options will show up c) Tap Developer Options d) Tap Get Token For app version < V9.0, a) Go to Profile > Preferences b) Tap App Version 10 times. Developer Options will show up c) Tap Developer Options d) Tap Get Token Roll up your sleeves and get your hands dirty with SwitchBot OpenAPI! Authentication Open Token and Secret Key Note: You must update the app to the latest version, V6.14 or later, in order to get the secret key. In SwitchBot API v1.1 , the authentication method has been improved. In order to gain access to private data through the API, you must generate a unique signature using a token and a secret key. When you make a request, the Authorization token and signature will be validated simultaneously. You as a developer will then be able to add, delete, edit, and look up your data including profile data and data associated with the devices that have been added to your SwitchBot account.
Context number 7 (score: 0.794307947): 
SwitchBot API v1.1 Introduction About the New Version Getting Started Authentication Open Token and Secret Key How to Sign? Python 2 example code Python 3 example code JavaScript example code C# example code Java 11+ example code PHP example code Glossary API Usage Host Domain Sending a Request Content-Type Request limit Request Header Standard HTTP Error Codes Devices Get device list Description Responses Bot Curtain Curtain 3 Hub/Hub Plus/Hub Mini/Hub 2 Meter Meter Plus Outdoor Meter Lock Lock Pro Keypad Keypad Touch Remote Motion Sensor Contact Sensor Water Leak Detector Ceiling Light Ceiling Light Pro Plug Mini (US) Plug Mini (JP) Plug Strip Light Color Bulb Robot Vacuum Cleaner S1 Robot Vacuum Cleaner S1 Plus Mini Robot Vacuum K10+ Mini Robot Vacuum K10+ Pro Floor Cleaning Robot S10 Humidifier Indoor Cam Pan/Tilt Cam Pan/Tilt Cam 2K Blind Tilt Battery Circulator Fan Virtual infrared remote devices Sample Get all devices Get device status Description Path parameters Responses Bot Curtain Curtain 3 Meter Meter Plus Outdoor Meter Lock Lock Pro Keypad Keypad Touch Motion Sensor Contact Sensor Water Leak Detector Ceiling Light Ceiling Light Pro Plug Mini (US) Plug Mini (JP) Plug Strip Light Color Bulb Robot Vacuum Cleaner S1 Robot Vacuum Cleaner S1 Plus Mini Robot Vacuum K10+ Mini Robot Vacuum K10+ Pro Floor Cleaning Robot S10 Humidifier Blind Tilt Hub 2 Battery Circulator Fan Sample SwitchBot Meter example SwitchBot Curtain example Send device control commands Description Command set for physical devices Bot Curtain Curtain 3 Lock Lock Pro Humidifier Plug Plug Mini (US) Plug Mini (JP) Color Bulb Strip Light Robot Vacuum Cleaner S1 Robot Vacuum Cleaner S1 Plus Mini Robot Vacuum K10+ Mini Robot Vacuum K10+ Pro Floor Cleaning Robot S10 Ceiling Light Ceiling Light Pro Keypad Keypad Touch Blind Tilt Battery Circulator Fan Command set for virtual infrared remote devices Path parameters Request body parameters Response Errors Sample Floor Cleaning Robot S10 example Keypad example Bot example Infrared remote device example Scenes Get scene list Description Response Errors Sample Get all scenes Execute manual scenes Description Path parameters Errors Sample Execute a scene Webhook Configure webhook Description Request Request body parameters Response Get webhook configuration Description Request Request body parameters queryUrl queryDetails Response queryUrl queryDetails Update webhook configuration Description Request Request body parameters Response Delete webhook Description Request Request body parameters Response Receive events from webhook Bot Curtain Curtain 3 Motion Sensor Contact Sensor Water Leak Detector Meter Meter Plus Outdoor Meter Lock Lock Pro Indoor Cam Pan/Tilt Cam Color Bulb LED
Context number 8 (score: 0.793007731): 
151 device type error 152 device not found 160 command is not supported 161 device offline 171 hub device is offline 190 Device internal error due to device states not synchronized with server. Or command format is invalid. Sample Bot example Turn a Bot on Request POST https://api.switch-bot.com/v1.0/devices/210/commands { "command" : "turnOn" , "parameter" : "default" , "commandType" : "command" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Set the color value of a Color Bulb Request POST https://api.switch-bot.com/v1.0/devices/84F70353A411/commands { "command" : "setColor" , "parameter" : "122:80:20" , // yellow "commandType" : "command" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Infrared remote device example Set an Air Conditioner Request POST https://api.switch-bot.com/v1.0/devices/02-202007201626-70/commands { "command" : "setAll" , "parameter" : "26,1,3,on" , "commandType" : "command" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Trigger a customized button Request POST https://api.switch-bot.com/v1.0/devices/02-202007201626-10/commands { "command" : "ボタン" , // the name of the customized button "parameter" : "default" , "commandType" : "customize" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Scenes The scenes API is used to access the smart scenes created by a user and to execute manual scenes. Get scene list GET /v1.0/scenes Description Get a list of manual scenes created by the current user. Response The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object The body object contains a list of objects, which has the following properties, Key Type Description sceneId String a scene's ID sceneName String a scene's name Errors Error code/message Description {"message": "Unauthorized"} Http 401 Error.
Context number 9 (score: 0.791362882): 
URI ; import java . net . http . HttpClient ; import java . net . http . HttpRequest ; import java . net . http . HttpResponse ; import java . net . http . HttpResponse . BodyHandlers ; import java . time . Instant ; import java . util . Base64 ; import java . util . UUID ; import javax . crypto . Mac ; import javax . crypto . spec . SecretKeySpec ; public class Main { public static void main ( String [] args ) throws Exception { String token = args [ 0 ]; String secret = args [ 1 ]; String nonce = UUID . randomUUID (). toString (); String time = "" + Instant . now (). toEpochMilli (); String data = token + time + nonce ; SecretKeySpec secretKeySpec = new SecretKeySpec ( secret . getBytes ( "UTF-8" ), "HmacSHA256" ); Mac mac = Mac . getInstance ( "HmacSHA256" ); mac . init ( secretKeySpec ); String signature = new String ( Base64 . getEncoder (). encode ( mac . doFinal ( data . getBytes ( "UTF-8" )))); HttpRequest getDevices = HttpRequest . newBuilder () . uri ( new URI ( "https://api.switch-bot.com/v1.1/devices" )) . header ( "Authorization" , token ) . header ( "sign" , signature ) . header ( "nonce" , nonce ) . header ( "t" , time ) . GET () . build (); HttpResponse < String > response = HttpClient . newBuilder (). build (). send ( getDevices , BodyHandlers . ofString ()); System . out . println ( response . body ()); } } PHP example code <?php $ token = ' XXXXXXXXXXXXXXXXXXX ' ; $ secret = ' YYYYYYYYYYY ' ; $ nonce = guidv4 (); $ t = time () * 1000 ; $ data = utf8_encode ( $ token . $ t .
Context number 10 (score: 0.787211657): 
Going over that limit will return "Unauthorized." Request Header The following parameters need to be included into the header, Parameter Type Location Required Description Authorization String header Yes Open Token acquired Standard HTTP Error Codes The following table lists the most common HTTP error response, Code Name Description 400 Bad Request The client has issued an invalid request. This is commonly used to specify validation errors in a request payload. 401 Unauthorized Authorization for the API is required, but the request has not been authenticated. 403 Forbidden The request has been authenticated but does not have appropriate permissions, or a requested resource is not found. 404 Not Found Specifies the requested path does not exist. 406 Not Acceptable The client has requested a MIME type via the Accept header for a value not supported by the server. 415 Unsupported Media Type The client has defined a contentType header that is not supported by the server. 422 Unprocessable Entity The client has made a valid request, but the server cannot process it. This is often used for APIs for which certain limits have been exceeded. 429 Too Many Requests The client has exceeded the number of requests allowed for a given time window. 500 Internal Server Error An unexpected error on the SmartThings servers has occurred. These errors should be rare. Devices The devices API is used to access the properties and states of SwitchBot devices and to send control commands to those devices. Get device list GET /v1.0/devices Description Get a list of devices, which include physical devices and virtual infrared remote devices that have been added to the current user's account. Physical devices refer to the following SwitchBot products, Hub Hub Plus Hub Mini Bot (MUST enable Cloud Service first) Curtain (MUST enable Cloud Service first) Plug Meter (MUST enable Cloud Service first) Motion Sensor (MUST enable Cloud Service first) Contact Sensor (MUST enable Cloud Service first) Color Bulb Humidifier Smart Fan Strip Light Plug Mini (US) Plug Mini (JP) Lock Meter Plus (JP) (MUST enable Cloud Service first) Meter Plus (US) (MUST enable Cloud Service first) new Robot Vacuum Cleaner S1 new Robot Vacuum Cleaner S1 Plus Virtual infrared remote devices refer to virtual devices that are used to simulate infrared signals of a home appliance remote control. A SwitchBot Hub Plus / Hub Mini is required in order to be able to create these virtual devices within the app.
Context number 11 (score: 0.785618126): 
A SwitchBot Hub Plus / Hub Mini is required in order to be able to create these virtual devices within the app. The types of appliances supported include, Air Conditioner TV Light IPTV/Streamer Set Top Box DVD Fan Projector Camera Air Purifier Speaker Water Heater Vacuum Cleaner Others Responses The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object The body object contains the following properties, Key Name Value Type Description deviceList Array a list of physical devices infraredRemoteList Array a list of virtual infrared remote devices The deviceList array contains a list of objects with the following key-value attributes, Key Value Type Description deviceId String device ID deviceName String device name deviceType String device type enableCloudService Boolean determines if Cloud Service is enabled or not for the current device hubDeviceId String device's parent Hub ID curtainDevicesIds Array only available for Curtain devices. a list of Curtain device IDs such that the Curtain devices are being paired or grouped calibrate Boolean only available for Curtain/Lock devices. determines if the open position and the close position of a device have been properly calibrated or not group Boolean only available for Curtain devices. determines if a Curtain is paired with or grouped with another Curtain or not master Boolean only available for Curtain devices. determines if a Curtain is the master device or not when paired with or grouped with another Curtain openDirection String only available for Curtain devices. the opening direction of a Curtain The infraredRemoteList array contains a list of objects with the following key-value attributes, Key Value Type Description deviceId String device ID deviceName String device name remoteType String device type hubDeviceId String remote device's parent Hub ID The response may contain the following codes and messages, Status Code Body Content Message Description 100 Device list object success Returns an object that contains two device lists n/a n/a Unauthorized Http 401 Error. User permission is denied due to invalid token.
Context number 12 (score: 0.785437644): 
Battery Circulator Fan enableCloudService Boolean determines if Cloud Service is enabled or not for the current device hubDeviceId String device's parent Hub ID Virtual infrared remote devices The infraredRemoteList array contains a list of objects with the following key-value attributes, Key Value Type Description deviceId String device ID deviceName String device name remoteType String device type hubDeviceId String remote device's parent Hub ID Sample Get all devices Request GET https://api.switch-bot.com/v1.1/devices Response { "statusCode" : 100 , "body" : { "deviceList" : [ { "deviceId" : "500291B269BE" , "deviceName" : "Living Room Humidifier" , "deviceType" : "Humidifier" , "enableCloudService" : true , "hubDeviceId" : "000000000000" } ] , "infraredRemoteList" : [ { "deviceId" : "02-202008110034-13" , "deviceName" : "Living Room TV" , "remoteType" : "TV" , "hubDeviceId" : "FA7310762361" } ] } , "message" : "success" } Get device status GET /v1.1/devices/{deviceId}/status Description Get the status of a physical device that has been added to the current user's account. Physical devices refer to the following SwitchBot products, Bot Plug Curtain Meter Motion Sensor Contact Sensor Color Bulb Humidifier Smart Fan Strip Light Plug Mini (US) Plug Mini (JP) Lock Meter Plus (JP) Meter Plus (US) Robot Vacuum Cleaner S1 Robot Vacuum Cleaner S1 Plus Keypad (MUST enable Cloud Service first) Keypad Touch (MUST enable Cloud Service first) Ceiling Light Ceiling Light Pro Hub 2 Outdoor Meter Battery Circulator Fan Lock Pro Floor Cleaning Robot S10 Water Leak Detector new Mini Robot Vacuum K10+ new Mini Robot Vacuum K10+ Pro Path parameters Name Type Required Description deviceId String Yes device ID Responses The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object The reponses may contain the following codes and message, Status Code Body Content Message Description 100 Device list object success Returns an object that contains two device lists n/a n/a Unauthorized Http 401 Error. User permission is denied due to invalid token.
Context number 13 (score: 0.785083294): 
"parameter" : "122:80:20" , // yellow "commandType" : "command" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Infrared remote device example Set an Air Conditioner Request POST https://api.switch-bot.com/v1.1/devices/02-202007201626-70/commands { "command" : "setAll" , "parameter" : "26,1,3,on" , "commandType" : "command" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Trigger a customized button Request POST https://api.switch-bot.com/v1.1/devices/02-202007201626-10/commands { "command" : "ボタン" , // the name of the customized button "parameter" : "default" , "commandType" : "customize" } Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Scenes The scenes API is used to access the smart scenes created by a user and to execute manual scenes. Get scene list GET /v1.1/scenes Description Get a list of manual scenes created by the current user. Response The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object The body object contains a list of objects, which has the following properties, Key Type Description sceneId String a scene's ID sceneName String a scene's name Errors Error code/message Description {"message": "Unauthorized"} Http 401 Error. User permission is denied due to invalid token.
Context number 14 (score: 0.782320499): 
User permission is denied due to invalid token. 190 Device internal error due to device states not synchronized with server Sample Execute a scene Request POST https://api.switch-bot.com/v1.0/scenes/T02-202009221414-48924101/execute Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Webhook Configure webhook Description Configure the url that all the webhook events will be sent to Request POST https://api.switch-bot.com/v1.0/webhook/setupWebhook Request body parameters Key Name Value Type Description action String the type of actions url String the url where all the events are sent to deviceList String the list of device ids, currently only supports "ALL" Head { "Content-type" : "application/json" , "Authorization" : your_token // enter your API token } Body { "action" : "setupWebhook" , "url" : url1 , // enter your url "deviceList" : "ALL" } Response Sample { "statusCode" : 100 , "body" : { } , "message" : "" } Get webhook configuration Description Get the current configuration info of the webhook Request POST https://api.switch-bot.com/v1.0/webhook/queryWebhook Request body parameters Key Name Value Type Description action String the type of actions, currently supports "queryUrl", "queryDetails" url String the url where all the events are sent to.
Context number 15 (score: 0.781513214): 
User permission is denied due to invalid token. 190 Device internal error due to device states not synchronized with server Sample Execute a scene Request POST https://api.switch-bot.com/v1.1/scenes/T02-202009221414-48924101/execute Response { "statusCode" : 100 , "body" : { } , "message" : "success" } Webhook Configure webhook Description Configure the url that all the webhook events will be sent to Request POST https://api.switch-bot.com/v1.1/webhook/setupWebhook Request body parameters Key Name Value Type Description action String the type of actions url String the url where all the events are sent to deviceList String the list of device ids, currently only supports "ALL" Head { "Content-type" : "application/json" , "Authorization" : your_token // enter your API token } Body { "action" : "setupWebhook" , "url" : url1 , // enter your url "deviceList" : "ALL" } Response Sample { "statusCode" : 100 , "body" : { } , "message" : "" } Get webhook configuration Description Get the current configuration info of the webhook Request POST https://api.switch-bot.com/v1.1/webhook/queryWebhook Request body parameters Key Name Value Type Description action String the type of actions, currently supports "queryUrl", "queryDetails" url String the url where all the events are sent to.
Context number 16 (score: 0.780098557): 
turn on: on ; turn off: off verticalOscillation String set vertical oscillation. turn on: on ; turn off: off chargingStatus String battery charge status. charging or uncharged fanSpeed Integer fan speed. 1~100 Sample SwitchBot Meter example Request the status of a SwitchBot Thermometer and Hygrometer Request GET https://api.switch-bot.com/v1.1/devices/C271111EC0AB/status Response { "statusCode" : 100 , "body" : { "deviceId" : "C271111EC0AB" , "deviceType" : "Meter" , "hubDeviceId" : "FA7310762361" , "humidity" : 52 , "temperature" : 26.1 } , "message" : "success" } SwitchBot Curtain example Request the status of a SwitchBot Curtain Request GET https://api.switch-bot.com/v1.1/devices/E2F6032048AB/status Response { "statusCode" : 100 , "body" : { "deviceId" : "E2F6032048AB" , "deviceType" : "Curtain" , "hubDeviceId" : "FA7310762361" , "calibrate" : true , "group" : false , "moving" : false , "slidePosition" : 0 } , "message" : "success" } Send device control commands POST /v1.1/devices/{deviceId}/commands Description Send control commands to physical devices and virtual infrared remote devices. Command set for physical devices Bot deviceType commandType Command command parameter Description Bot command turnOff default set to OFF state Bot command turnOn default set to ON state Bot command press default trigger press Curtain deviceType commandType Command command parameter Description Curtain command setPosition index0,mode0,position0 e.g. 0,ff,80 mode: 0 (Performance Mode), 1 (Silent Mode), ff (default mode) position: 0~100 (0 means open, 100 means closed) Curtain command turnOff default equivalent to set position to 100 Curtain command turnOn default equivalent to set position to 0 Curtain command pause default set to PAUSE state Curtain 3 deviceType commandType Command command parameter Description Curtain 3 command setPosition index0,mode0,position0 e.g. 0,ff,80 mode: 0 (Performance Mode), 1 (Silent Mode),
Context number 17 (score: 0.776061356): 
User permission is denied due to invalid token. 190 Device internal error due to device states not synchronized with server Sample Get all scenes Request GET https://api.switch-bot.com/v1.1/scenes Response { "statusCode" : 100 , "body" : [ { "sceneId" : "T02-20200804130110" , "sceneName" : "Close Office Devices" } , { "sceneId" : "T02-202009221414-48924101" , "sceneName" : "Set Office AC to 25" } , { "sceneId" : "T02-202011051830-39363561" , "sceneName" : "Set Bedroom to 24" } , { "sceneId" : "T02-202011051831-82928991" , "sceneName" : "Turn off home devices" } , { "sceneId" : "T02-202011062059-26364981" , "sceneName" : "Set Bedroom to 26 degree" } ] , "message" : "success" } Execute manual scenes POST /v1.1/scenes/{sceneId}/execute Description Sends a request to execute a manual scene. Path parameters Name Type Required Description sceneId String Yes scene ID The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object Errors Error code/message Description {"message": "Unauthorized"} Http 401 Error. User permission is denied due to invalid token.
Context number 18 (score: 0.775120795): 
User permission is denied due to invalid token. 190 Device internal error due to device states not synchronized with server Sample Get all scenes Request GET https://api.switch-bot.com/v1.0/scenes Response { "statusCode" : 100 , "body" : [ { "sceneId" : "T02-20200804130110" , "sceneName" : "Close Office Devices" } , { "sceneId" : "T02-202009221414-48924101" , "sceneName" : "Set Office AC to 25" } , { "sceneId" : "T02-202011051830-39363561" , "sceneName" : "Set Bedroom to 24" } , { "sceneId" : "T02-202011051831-82928991" , "sceneName" : "Turn off home devices" } , { "sceneId" : "T02-202011062059-26364981" , "sceneName" : "Set Bedroom to 26 degree" } ] , "message" : "success" } Execute manual scenes POST /v1.0/scenes/{sceneId}/execute Description Sends a request to execute a manual scene. Path parameters Name Type Required Description sceneId String Yes scene ID The response is basically a JSON object, which contains the following properties, Key Name Value Type statusCode Integer message String body Object Errors Error code/message Description {"message": "Unauthorized"} Http 401 Error. User permission is denied due to invalid token.
Context number 19 (score: 0.774809599): 
W0202200 Hub Plus Short for SwitchBot Hub Plus Model No. SwitchBot Hub S1 Bot Short for SwitchBot Bot Model No. SwitchBot S1 Curtain Short for SwitchBot Curtain Model No. W0701600 Plug Short for SwitchBot Plug Model No. SP11 Meter Short for SwitchBot Thermometer and Hygrometer Model No. SwitchBot MeterTH S1 Meter Plus (JP) Short for SwitchBot Thermometer and Hygrometer Plus (JP) Model No. W2201500 Meter Plus (US) Short for SwitchBot Thermometer and Hygrometer Plus (US) Model No. W2301500 Motion Sensor Short for SwitchBot Motion Sensor Model No. W1101500 Contact Sensor Short for SwitchBot Contact Sensor Model No. W1201500 Color Bulb Short for SwitchBot Color Bulb Model No. W1401400 Smart Fan Short for SwitchBot Smart Fan Model No. W0601100 Strip Light Short for SwitchBot LED Strip Light Model No. W1701100 Plug Mini (US) Short for SwitchBot Plug Mini (US) Model No. W1901400 Plug Mini (JP) Short for SwitchBot Plug Mini (JP) Model No. W2001400 Lock Short for SwitchBot Lock Model No. W1601700 Robot Vacuum Cleaner S1 Short for SwitchBot Robot Vacuum Cleaner S1 Model No. W3011000; currently only available in Japan Robot Vacuum Cleaner S1 Plus Short for SwitchBot Robot Vacuum Cleaner S1 Plus Model No. W3011010; currently only available in Japan Cloud Service An SwitchBot app feature that 1. enables SwitchBot products to be discovered and communicated with third-party services voice control services, 2. allows users to create customized smart scenes and Android widgets. For BLE-based devices such as Bot and Curtain, you MUST first add a Hub/Hub Mini/Hub Plus and then enable Cloud Service on the Settings page in order to make use of the web API! API Usage Host Domain https://api.switch-bot.com Sending a Request The following request types are supported, GET PUT POST DELETE Content-Type For POST requests, use application/json; charset=utf8 as the Content-Type Request limit The amount of API calls per day is limited to 10000 times. Going over that limit will return "Unauthorized."
Context number 20 (score: 0.772294641): 
length , } , } ; const req = https . request ( options , res => { console . log ( `statusCode: ${ res . statusCode } ` ) ; res . on ( 'data' , d => { process . stdout . write ( d ) ; } ) ; } ) ; req . on ( 'error' , error => { console . error ( error ) ; } ) ; req . write ( body ) ; req . end ( ) ; C# example code using System ; using System . Diagnostics ; using System . Text ; using System . Security . Cryptography ; using System . Net . Http ; string token = " My Token " ; string secret = " My Secret Key " ; DateTime dt1970 = new DateTime ( 1970 , 1 , 1 ) ; DateTime current = DateTime . Now ; TimeSpan span = current - dt1970 ; long time = Convert . ToInt64 ( span . TotalMilliseconds ) ; string nonce = Guid . NewGuid ( ) . ToString ( ) ; string data = token + time . ToString ( ) + nonce ; Encoding utf8 = Encoding . UTF8 ; HMACSHA256 hmac = new HMACSHA256 ( utf8 . GetBytes ( secret ) ) ; string signature = Convert . ToBase64String ( hmac . ComputeHash ( utf8 . GetBytes ( data ) ) ) ; //Create http client HttpClient client = new HttpClient ( ) ; var request = new HttpRequestMessage ( HttpMethod . Get , @"https://api.switch-bot.com/v1.1/devices" ) ; request . Headers . TryAddWithoutValidation ( @"Authorization" , token ) ; request . Headers . TryAddWithoutValidation ( @"sign" , signature ) ; request . Headers . TryAddWithoutValidation ( @"nonce" , nonce ) ; request . Headers . TryAddWithoutValidation ( @"t" , time . ToString ( ) ) ; var response = await client . SendAsync ( request ) ; Console . WriteLine ( await response . Content . ReadAsStringAsync ( ) ) ; Java 11+ example code import java . net . URI ; import java . net . http . HttpClient ; import java . net . http . HttpRequest ; import java . net . http . HttpResponse ; import java . net . http .